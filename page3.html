<!DOCTYPE html>
<html>
<head>
    <script async src="https://www.googletagmanager.com/gtag/js?id=G-P4ZGD289Y7"></script>
    <script>
        window.dataLayer = window.dataLayer || [];
        function gtag(){dataLayer.push(arguments);}
        gtag('js', new Date());
        gtag('config', 'G-P4ZGD289Y7');
        
        // 记录进入时间
        sessionStorage.setItem('page3_enter', Date.now());
    </script>
    <title>用戶主頁</title>
</head>
<body>
    <h1>歡迎回來！</h1>
    <input type="text" id="userMessage" placeholder="輸入訊息">
    <button type="button" onclick="handleSend()">發送</button>

    <script>
        // 发送停留时间事件
        function trackPage3Stay() {
            const staySeconds = (Date.now() - parseInt(sessionStorage.getItem('page3_enter'))) / 1000;
            gtag('event', 'page3_stay', {
                'stay_seconds': staySeconds,
                'page_path': '/page3.html'
            });
        }

        // 发送按钮事件（含消息内容）
        function handleSend() {
            // 先发送停留时间
            trackPage3Stay();
            
            // 获取用户输入
            const message = document.getElementById('userMessage').value;
            
            // 发送按钮点击事件
            gtag('event', 'page3_button_click', {
                'click_timestamp': Date.now(),
                'button_name': '發送',
                'message_content': message || '空消息'
            });
            
            alert('已模擬發送！');
        }

        // 页面关闭时补发停留时间
        window.addEventListener('beforeunload', trackPage3Stay);
    </script>
</body>
</html>