<!DOCTYPE html>
<html>
<head>
    <!-- 保留原有 GA4 代码 -->
    <script async src="https://www.googletagmanager.com/gtag/js?id=G-P4ZGD289Y7"></script>
    <script>
        window.dataLayer = window.dataLayer || [];
        function gtag(){dataLayer.push(arguments);}
        gtag('js', new Date());
        gtag('config', 'G-P4ZGD289Y7');
    </script>
    
    <!-- 新增视口适配 -->
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>星際註冊站</title>
    <style>
        /* [保留所有原有CSS样式] */
    </style>
</head>
<body>
    <div class="stars" id="stars"></div>
    
    <div class="container">
        <h1>星際通行證註冊</h1>
        <form id="signupForm">
            <input type="email" placeholder="量子郵件地址" required>
            <button type="button" onclick="handleSignup()">啟動傳送</button>
        </form>
    </div>

    <script>
        // 记录进入时间（补回遗漏）
        sessionStorage.setItem('page1_enter', Date.now());

        // 生成星空效果
        function createStars() {
            const starsContainer = document.getElementById('stars');
            for (let i = 0; i < 100; i++) {
                const star = document.createElement('div');
                star.className = 'star';
                star.style.left = `${Math.random() * 100}%`;
                star.style.top = `${Math.random() * 100}%`;
                star.style.width = star.style.height = `${Math.random() * 3}px`;
                star.style.setProperty('--duration', `${Math.random() * 3 + 1}s`);
                starsContainer.appendChild(star);
            }
        }
        createStars();

        // 停留时间统计（补回遗漏）
        function trackPage1Stay() {
            const enterTime = parseInt(sessionStorage.getItem('page1_enter'));
            if (!isNaN(enterTime)) {
                const staySeconds = (Date.now() - enterTime) / 1000;
                gtag('event', 'page1_stay', {
                    'stay_seconds': staySeconds,
                    'page_path': location.pathname
                });
            }
        }

        // 按钮点击处理（补回遗漏）
        function handleSignup() {
            // 验证表单
            const emailInput = document.querySelector('input[type="email"]');
            if (!emailInput.checkValidity()) {
                alert('請輸入有效的量子郵件地址！');
                return;
            }

            // 上报数据
            trackPage1Stay();
            gtag('event', 'page1_button_click', {
                'click_timestamp': Date.now(),
                'button_name': '啟動傳送'
            });

            // 跳转页面
            window.location.href = 'page2.html';
        }

        // 页面关闭事件（补回遗漏）
        window.addEventListener('beforeunload', trackPage1Stay);
    </script>
</body>
</html>